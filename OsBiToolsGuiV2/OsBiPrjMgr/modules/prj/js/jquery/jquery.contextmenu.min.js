jQuery.fn.contextPopup=function(e){var l={contextMenuClass:"contextMenuPlugin",gutterLineClass:"gutterLine",headerClass:"header",seperatorClass:"divider",title:"",items:[],appendTo:"body"};return $.extend(l,e),this.bind("contextmenu",function(e){var i,a,t=(i=e,a=$('<ul class="'+l.contextMenuClass+'"><div class="'+l.gutterLineClass+'"></div></ul>').appendTo(l.appendTo),l.title&&$('<li class="'+l.headerClass+'"></li>').text(l.title).appendTo(a),l.items.forEach(function(e){if(e){var t=$('<li><a href="#"><span></span></a></li>').appendTo(a);if(e.icon){var n=$("<img>");n.attr("src",e.icon),n.insertBefore(t.find("span"))}t.find("span").text(e.label),null==e.isEnabled||e.isEnabled()?e.action&&t.find("a").click(function(){e.action(i)}):t.addClass("disabled")}else $('<li class="'+l.seperatorClass+'"></li>').appendTo(a)}),a.find("."+l.headerClass).text(l.title),a).show(),n=e.pageX+5,s=e.pageY;s+t.height()>=$(window).height()&&(s-=t.height()),n+t.width()>=$(window).width()&&(n-=t.width()),t.css({zIndex:1000001,left:n,top:s}).bind("contextmenu",function(){return!1});var o=$('<div class="contextMenuPluginCtrl"></div>').css({left:0,top:0,width:"100%",height:"100%",position:"absolute",zIndex:1e6}).appendTo(l.appendTo).bind("contextmenu click",function(){return o.remove(),t.remove(),!1});return t.find("a").click(function(){o.remove(),t.remove()}),!1}),this};