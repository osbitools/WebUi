jQuery.fn.contextPopup=function(e){function t(e){var t=$('<ul class="'+n.contextMenuClass+'"><div class="'+n.gutterLineClass+'"></div></ul>').appendTo(document.body);return n.title&&$('<li class="'+n.headerClass+'"></li>').text(n.title).appendTo(t),n.items.forEach(function(i){if(i){var s='<li><a href="#"><span></span></a></li>',a=$(s).appendTo(t);if(i.icon){var o=$("<img>");o.attr("src",i.icon),o.insertBefore(a.find("span"))}a.find("span").text(i.label),void 0==i.isEnabled||i.isEnabled()?i.action&&a.find("a").click(function(){i.action(e)}):a.addClass("disabled")}else $('<li class="'+n.seperatorClass+'"></li>').appendTo(t)}),t.find("."+n.headerClass).text(n.title),t}var n={contextMenuClass:"contextMenuPlugin",gutterLineClass:"gutterLine",headerClass:"header",seperatorClass:"divider",title:"",items:[]};return $.extend(n,e),this.bind("contextmenu",function(e){var n=t(e).show(),i=e.pageX+5,s=e.pageY;s+n.height()>=$(window).height()&&(s-=n.height()),i+n.width()>=$(window).width()&&(i-=n.width()),n.css({zIndex:1000001,left:i,top:s}).bind("contextmenu",function(){return!1});var a=$('<div class="contextMenuPluginCtrl"></div>').css({left:0,top:0,width:"100%",height:"100%",position:"absolute",zIndex:1e6}).appendTo(document.body).bind("contextmenu click",function(){return a.remove(),n.remove(),!1});return n.find("a").click(function(){a.remove(),n.remove()}),!1}),this};